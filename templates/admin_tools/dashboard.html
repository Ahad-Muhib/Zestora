{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard - Zestora{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="dashboard-header">
        <h1><i class="fas fa-tachometer-alt me-3"></i>Admin Dashboard</h1>
        <p class="text-muted">Overview of platform statistics and recent activity</p>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card primary">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_users }}</h3>
                <p>Total Users</p>
                <small class="text-success">+{{ new_users_week }} this week</small>
            </div>
        </div>

        <div class="stat-card success">
            <div class="stat-icon">
                <i class="fas fa-utensils"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_recipes }}</h3>
                <p>Total Recipes</p>
                <small class="text-success">+{{ new_recipes_week }} this week</small>
            </div>
        </div>

        <div class="stat-card info">
            <div class="stat-icon">
                <i class="fas fa-comments"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_comments }}</h3>
                <p>Total Comments</p>
                <small class="text-success">+{{ new_comments_week }} this week</small>
            </div>
        </div>

        <div class="stat-card warning">
            <div class="stat-icon">
                <i class="fas fa-heart"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_likes }}</h3>
                <p>Total Likes</p>
                <small class="text-muted">{{ total_dislikes }} dislikes</small>
            </div>
        </div>

        <div class="stat-card secondary">
            <div class="stat-icon">
                <i class="fas fa-tags"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_categories }}</h3>
                <p>Categories</p>
                <small class="text-muted">Recipe categories</small>
            </div>
        </div>
    </div>

    <div class="dashboard-content">
        <div class="row">
            <!-- Most Active Users -->
            <div class="col-lg-6 mb-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h5><i class="fas fa-star me-2"></i>Most Active Users</h5>
                    </div>
                    <div class="card-body">
                        {% for user_data in most_active_users %}
                        <div class="user-item">
                            <div class="user-info">
                                <div class="user-avatar">
                                    {{ user_data.user.first_name.0|default:user_data.user.username.0|upper }}
                                </div>
                                <div class="user-details">
                                    <strong>{{ user_data.user.get_full_name|default:user_data.user.username }}</strong>
                                    <small class="text-muted d-block">{{ user_data.recipe_count }} recipe{{ user_data.recipe_count|pluralize }}</small>
                                </div>
                            </div>
                            <span class="badge bg-primary">{{ user_data.recipe_count }}</span>
                        </div>
                        {% empty %}
                        <p class="text-muted">No active users yet.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Popular Recipes -->
            <div class="col-lg-6 mb-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h5><i class="fas fa-fire me-2"></i>Popular Recipes</h5>
                    </div>
                    <div class="card-body">
                        {% for recipe in popular_recipes %}
                        <div class="recipe-item">
                            <div class="recipe-info">
                                <strong>{{ recipe.title|truncatechars:30 }}</strong>
                                <small class="text-muted d-block">by {{ recipe.author.username }}</small>
                            </div>
                            <span class="badge bg-danger">{{ recipe.total_likes }} <i class="fas fa-heart"></i></span>
                        </div>
                        {% empty %}
                        <p class="text-muted">No recipes yet.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Recent Users -->
            <div class="col-lg-6 mb-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h5><i class="fas fa-user-plus me-2"></i>Recent Users</h5>
                    </div>
                    <div class="card-body">
                        {% for user in recent_users %}
                        <div class="user-item">
                            <div class="user-info">
                                <div class="user-avatar">
                                    {{ user.first_name.0|default:user.username.0|upper }}
                                </div>
                                <div class="user-details">
                                    <strong>{{ user.get_full_name|default:user.username }}</strong>
                                    <small class="text-muted d-block">Joined {{ user.date_joined|date:"M d, Y" }}</small>
                                </div>
                            </div>
                            {% if user.is_staff %}
                                <span class="badge bg-warning">Staff</span>
                            {% elif user.is_superuser %}
                                <span class="badge bg-danger">Admin</span>
                            {% else %}
                                <span class="badge bg-success">User</span>
                            {% endif %}
                        </div>
                        {% empty %}
                        <p class="text-muted">No users yet.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Categories Stats -->
            <div class="col-lg-6 mb-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-pie me-2"></i>Categories Overview</h5>
                    </div>
                    <div class="card-body">
                        {% for category in categories_stats %}
                        <div class="category-item">
                            <div class="category-info">
                                <strong>{{ category.name }}</strong>
                            </div>
                            <div class="category-stats">
                                <span class="badge bg-primary">{{ category.recipe_count }}</span>
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-muted">No categories yet.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.admin-dashboard {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.dashboard-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 20px 0;
}

.dashboard-header h1 {
    color: #333;
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.stat-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 20px;
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.stat-card.primary .stat-icon { background: linear-gradient(45deg, #007bff, #0056b3); }
.stat-card.success .stat-icon { background: linear-gradient(45deg, #28a745, #1e7e34); }
.stat-card.info .stat-icon { background: linear-gradient(45deg, #17a2b8, #117a8b); }
.stat-card.warning .stat-icon { background: linear-gradient(45deg, #ffc107, #e0a800); }
.stat-card.secondary .stat-icon { background: linear-gradient(45deg, #6c757d, #545b62); }

.stat-content h3 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 5px;
    color: #333;
}

.stat-content p {
    font-size: 1rem;
    color: #666;
    margin-bottom: 5px;
}

.dashboard-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    overflow: hidden;
}

.card-header {
    background: linear-gradient(135deg, #ff6b5a, #ff8c42);
    color: white;
    padding: 20px;
    border: none;
}

.card-header h5 {
    margin: 0;
    font-weight: 600;
}

.card-body {
    padding: 20px;
    max-height: 400px;
    overflow-y: auto;
}

.user-item, .recipe-item, .category-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #eee;
}

.user-item:last-child, .recipe-item:last-child, .category-item:last-child {
    border-bottom: none;
}

.user-info, .recipe-info, .category-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    background: linear-gradient(45deg, #ff6b5a, #ff8c42);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1rem;
}

.user-details strong, .recipe-info strong, .category-info strong {
    color: #333;
    font-size: 0.95rem;
}

.badge {
    font-size: 0.8rem;
    padding: 6px 12px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .admin-dashboard {
        padding: 15px;
    }
    
    .dashboard-header h1 {
        font-size: 2rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .stat-card {
        padding: 20px;
        gap: 15px;
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
    }
    
    .stat-content h3 {
        font-size: 1.5rem;
    }
}
</style>
{% endblock %}