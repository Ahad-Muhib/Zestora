{% extends 'base.html' %}
{% load static %}

{% block title %}System Tools - Admin{% endblock %}

{% block content %}
<div class="system-tools">
    <div class="page-header">
        <h1><i class="fas fa-tools me-3"></i>System Tools</h1>
        <p class="text-muted">System maintenance and monitoring tools</p>
    </div>

    <!-- Database Statistics -->
    <div class="section">
        <h3><i class="fas fa-database me-2"></i>Database Statistics</h3>
        <div class="db-stats-grid">
            {% for key, value in db_stats.items %}
            <div class="db-stat-card">
                <div class="stat-icon">
                    {% if key == 'users' %}
                        <i class="fas fa-users"></i>
                    {% elif key == 'recipes' %}
                        <i class="fas fa-utensils"></i>
                    {% elif key == 'comments' %}
                        <i class="fas fa-comments"></i>
                    {% elif key == 'likes' %}
                        <i class="fas fa-heart"></i>
                    {% elif key == 'categories' %}
                        <i class="fas fa-tags"></i>
                    {% elif key == 'profiles' %}
                        <i class="fas fa-user-circle"></i>
                    {% elif key == 'stories' %}
                        <i class="fas fa-book"></i>
                    {% endif %}
                </div>
                <div class="stat-content">
                    <h4>{{ value }}</h4>
                    <p>{{ key|title }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Activity Statistics -->
    <div class="section">
        <h3><i class="fas fa-chart-line me-2"></i>Activity Statistics</h3>
        <div class="activity-grid">
            <div class="activity-card">
                <h4>Today's Activity</h4>
                <div class="activity-stats">
                    <div class="activity-item">
                        <span class="label">New Users:</span>
                        <span class="value">{{ activity_stats.users_today }}</span>
                    </div>
                    <div class="activity-item">
                        <span class="label">New Recipes:</span>
                        <span class="value">{{ activity_stats.recipes_today }}</span>
                    </div>
                </div>
            </div>

            <div class="activity-card">
                <h4>This Week</h4>
                <div class="activity-stats">
                    <div class="activity-item">
                        <span class="label">New Users:</span>
                        <span class="value">{{ activity_stats.users_week }}</span>
                    </div>
                    <div class="activity-item">
                        <span class="label">New Recipes:</span>
                        <span class="value">{{ activity_stats.recipes_week }}</span>
                    </div>
                </div>
            </div>

            <div class="activity-card">
                <h4>This Month</h4>
                <div class="activity-stats">
                    <div class="activity-item">
                        <span class="label">New Users:</span>
                        <span class="value">{{ activity_stats.users_month }}</span>
                    </div>
                    <div class="activity-item">
                        <span class="label">New Recipes:</span>
                        <span class="value">{{ activity_stats.recipes_month }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Management -->
    <div class="section">
        <h3><i class="fas fa-folder me-2"></i>File Management</h3>
        <div class="file-stats-grid">
            <div class="file-stat-card">
                <div class="file-icon">
                    <i class="fas fa-images"></i>
                </div>
                <div class="file-content">
                    <h4>{{ recipe_images }}</h4>
                    <p>Recipe Images</p>
                </div>
            </div>

            <div class="file-stat-card">
                <div class="file-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="file-content">
                    <h4>{{ profile_images }}</h4>
                    <p>Profile Images</p>
                </div>
            </div>

            <div class="file-stat-card">
                <div class="file-icon">
                    <i class="fas fa-file"></i>
                </div>
                <div class="file-content">
                    <h4>{{ total_files }}</h4>
                    <p>Total Files</p>
                </div>
            </div>
        </div>
    </div>

    <!-- System Actions -->
    <div class="section">
        <h3><i class="fas fa-cogs me-2"></i>System Actions</h3>
        <div class="actions-grid">
            <div class="action-card">
                <div class="action-icon">
                    <i class="fas fa-broom"></i>
                </div>
                <div class="action-content">
                    <h5>Clear Cache</h5>
                    <p>Clear application cache and temporary files</p>
                    <button class="btn btn-outline-primary" onclick="clearCache()">
                        <i class="fas fa-broom me-2"></i>Clear Cache
                    </button>
                </div>
            </div>

            <div class="action-card">
                <div class="action-icon">
                    <i class="fas fa-download"></i>
                </div>
                <div class="action-content">
                    <h5>Backup Database</h5>
                    <p>Create a backup of the current database</p>
                    <button class="btn btn-outline-success" onclick="backupDatabase()">
                        <i class="fas fa-download me-2"></i>Backup DB
                    </button>
                </div>
            </div>

            <div class="action-card">
                <div class="action-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div class="action-content">
                    <h5>Generate Report</h5>
                    <p>Generate comprehensive system report</p>
                    <button class="btn btn-outline-info" onclick="generateReport()">
                        <i class="fas fa-chart-bar me-2"></i>Generate
                    </button>
                </div>
            </div>

            <div class="action-card">
                <div class="action-icon">
                    <i class="fas fa-sync"></i>
                </div>
                <div class="action-content">
                    <h5>Sync Data</h5>
                    <p>Synchronize and validate data integrity</p>
                    <button class="btn btn-outline-warning" onclick="syncData()">
                        <i class="fas fa-sync me-2"></i>Sync
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- System Information -->
    <div class="section">
        <h3><i class="fas fa-info-circle me-2"></i>System Information</h3>
        <div class="system-info-card">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Django Version:</span>
                    <span class="info-value">5.2.6</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Python Version:</span>
                    <span class="info-value">3.13</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Database:</span>
                    <span class="info-value">SQLite</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Environment:</span>
                    <span class="info-value">Development</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Debug Mode:</span>
                    <span class="info-value">Enabled</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Last Restart:</span>
                    <span class="info-value">{{ request.session.session_key|default:"N/A" }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.system-tools {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.page-header {
    text-align: center;
    margin-bottom: 40px;
}

.page-header h1 {
    color: #333;
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.section {
    margin-bottom: 50px;
}

.section h3 {
    color: #333;
    margin-bottom: 25px;
    font-size: 1.5rem;
    font-weight: 600;
}

/* Database Stats */
.db-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.db-stat-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.db-stat-card:hover {
    transform: translateY(-5px);
}

.stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(45deg, #ff6b5a, #ff8c42);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
}

.stat-content h4 {
    margin: 0;
    color: #333;
    font-size: 1.8rem;
    font-weight: 700;
}

.stat-content p {
    margin: 0;
    color: #666;
    font-size: 0.9rem;
}

/* Activity Stats */
.activity-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
}

.activity-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

.activity-card h4 {
    color: #333;
    margin-bottom: 20px;
    font-size: 1.2rem;
    font-weight: 600;
    border-bottom: 2px solid #ff6b5a;
    padding-bottom: 10px;
}

.activity-stats {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.activity-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
}

.activity-item .label {
    color: #666;
    font-weight: 500;
}

.activity-item .value {
    color: #ff6b5a;
    font-weight: 700;
    font-size: 1.1rem;
}

/* File Stats */
.file-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.file-stat-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

.file-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(45deg, #28a745, #20c997);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
}

.file-content h4 {
    margin: 0;
    color: #333;
    font-size: 1.8rem;
    font-weight: 700;
}

.file-content p {
    margin: 0;
    color: #666;
    font-size: 0.9rem;
}

/* Actions */
.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
}

.action-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.action-card:hover {
    transform: translateY(-5px);
}

.action-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(45deg, #6c757d, #495057);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    margin: 0 auto 20px;
}

.action-content h5 {
    color: #333;
    margin-bottom: 10px;
    font-weight: 600;
}

.action-content p {
    color: #666;
    margin-bottom: 20px;
    font-size: 0.9rem;
}

/* System Info */
.system-info-card {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid #eee;
}

.info-item:last-child {
    border-bottom: none;
}

.info-label {
    font-weight: 600;
    color: #333;
}

.info-value {
    color: #ff6b5a;
    font-weight: 500;
}

/* Responsive Design */
@media (max-width: 768px) {
    .system-tools {
        padding: 15px;
    }
    
    .db-stats-grid,
    .file-stats-grid {
        grid-template-columns: 1fr;
    }
    
    .activity-grid,
    .actions-grid {
        grid-template-columns: 1fr;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function clearCache() {
    if (confirm('Are you sure you want to clear the cache?')) {
        alert('Cache clearing functionality would be implemented here.\n\nThis would typically:\n- Clear Django cache\n- Clear browser cache\n- Clear temporary files');
    }
}

function backupDatabase() {
    if (confirm('Are you sure you want to create a database backup?')) {
        alert('Database backup functionality would be implemented here.\n\nThis would typically:\n- Create SQL dump\n- Save to backup directory\n- Notify admin of completion');
    }
}

function generateReport() {
    alert('Report generation functionality would be implemented here.\n\nThis would typically:\n- Generate PDF/Excel reports\n- Include user statistics\n- Include system metrics\n- Email to administrators');
}

function syncData() {
    if (confirm('Are you sure you want to sync data?')) {
        alert('Data synchronization functionality would be implemented here.\n\nThis would typically:\n- Validate data integrity\n- Fix orphaned records\n- Update statistics\n- Sync user profiles');
    }
}
</script>
{% endblock %}